<template>
    <require from="../Base/patient-search/patient-search"></require>

    <section class="gs-container">

        <p class="gs-instructions">
            Below is an example of how the NRLS may help work for a Mental Health Nurse.<br />
            Try completing the required fields(*) of the Mental Health Care Plan - then press <a href="javascript:void(0)" class="btn btn-primary">Submit</a> to see how you can positively affect others through using NRLS.<br /><br />
            You can toggle between reading 'NRLS Pointers' as a Consumer and 'Create/Edit Care Plan' as a Provider to view how the system may look in the different scenarios.
        </p>

        <div class="generic-system-wrapper yellow-tooltips gs-as-call-handler">
            <div class="gs-header">
                <ul class="gs-top-menu">
                    <li><a href="javascript:void(0)" click.delegate="findPatient()">Find a Patient</a></li>
                    <li><a href="javascript:void(0)" data-toggle="tooltip" data-placement="top" title="This tab is disabled in the Demo.">Help</a></li>
                    <li><a href="javascript:void(0)" data-toggle="tooltip" data-placement="top" title="This tab is disabled in the Demo.">Exit</a></li>
                </ul>
                <h3 class="gs-title">${data.genericSystem.name}</h3>
            </div>

            <div show.bind="!showPatientSearch" class="gs-patient-banner">
                <span class="item"><strong>${patient.currentName.givenString} ${patient.currentName.family}</strong></span>
                <span class="item"><em>DoB</em> ${patient.birthDate | dateFormat : 'YYYY-MM-DDTHH:mm:ss' : 'Do MMM YYYY' }</span>
                <span class="item">${patient.gender}</span>
                <span class="item"><em>NHS</em> ${patient.nhsNumber | nhsNumber}</span>
                <span class="item" title.bind="patient.gpPractice.name"><em>GP Practice</em> ${patient.gpPractice.orgCode}</span>
                <span class="item"><em>Address</em> ${patient.currentAddress.line[0]}, ${patient.currentAddress.city}, ${patient.currentAddress.postalCode}</span>
            </div>

            <div show.bind="!showPatientSearch" class="gs-sub-header">
                <ul class="gs-records-menu">
                    <li><a href="javascript:void(0)" data-toggle="tooltip" data-placement="top" title="This tab is disabled in the Demo.">Mental Health</a></li>
                    <li><a href="javascript:void(0)" data-toggle="tooltip" data-placement="top" title="This tab is disabled in the Demo.">Physical Health</a></li>
                    <li><a href="javascript:void(0)" data-toggle="tooltip" data-placement="top" title="This tab is disabled in the Demo.">Social</a></li>
                    <li><a href="javascript:void(0)" data-toggle="tooltip" data-placement="top" title="This tab is disabled in the Demo.">Financial</a></li>
                    <li class="${ showCrisisPlan ? 'active' : '' }"><a href="javascript:void(0)" click.delegate="showCrisisPanel()">Crisis Plan</a></li>
                    <li class="${ showNrlsPointers ? 'active' : '' } aurelia-hide"><a href="javascript:void(0)" click.delegate="showPointersPanel()">NRLS</a></li>
                </ul>
            </div>

            <div if.bind="showPatientSearch" class="gs-content">
                <patient-search selected-patient.two-way="selectedPatient"></patient-search>
            </div>

            <div if.bind="!showPatientSearch" class="gs-content">
                <div show.bind="showCrisisPlan" class="tab-crisis-plan">
                    <div show.bind="!hasCrisisPlan && !allowCrisisPlan">
                        <p>This Patient does not have a Crisis Plan.</p>
                        <p>Would you like to create one? <button class="btn btn-primary" type="button" click.delegate="allowCrisisPlan = true">Yes</button></p>
                    </div>
                    <form show.bind="allowCrisisPlan || hasCrisisPlan">

                        <spinner-msg message="Updating Plan" logic.one-way="updatingPlan"></spinner-msg>

                        <table show.bind="!updatingPlan" class="table table-striped table-bordered nrls-pointer-results">
                            <caption>Crisis and Saftey Plan <i class="fa fa-info-circle"></i></caption>
                            <tbody>
                                <tr>
                                    <td width="25%">Do I wish to involve a family member or carer? *</td>
                                    <td>
                                        <div validation-errors.bind="involveFamilyOrCarerErrors" class.bind="involveFamilyOrCarerErrors.length ? 'has-error' : ''">
                                            <label class="radio-inline">
                                                <input type="radio" name="involveFamilyOrCarer" model.bind="true" id="involveFamilyOrCarer1" checked.bind="crisisPlan.involveFamilyOrCarer & validate" value="true"> Yes
                                            </label>
                                            <label class="radio-inline">
                                                <input type="radio" name="involveFamilyOrCarer" model.bind="false" id="involveFamilyOrCarer2" checked.bind="crisisPlan.involveFamilyOrCarer & validate" value="false"> No
                                            </label>
                                            <br if.bind="involveFamilyOrCarerErrors.length" />
                                            <span class="help-block" repeat.for="errorInfo of involveFamilyOrCarerErrors">
                                                ${errorInfo.error.message}
                                            </span>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>What are the signs that I'm feeling well?*</td>
                                    <td>
                                        <div class="form-group" validation-errors.bind="signsFeelingUnwellErrors" class.bind="signsFeelingUnwellErrors.length ? 'has-error' : ''">
                                            <textarea class="form-control" value.bind="crisisPlan.signsFeelingUnwell & validate" rows="1"></textarea>
                                            <span class="help-block" repeat.for="errorInfo of signsFeelingUnwellErrors">
                                                ${errorInfo.error.message}
                                            </span>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>What are the potential triggers?*</td>
                                    <td>
                                        <div class="form-group" validation-errors.bind="potentialTriggersErrors" class.bind="potentialTriggersErrors.length ? 'has-error' : ''">
                                            <textarea class="form-control" value.bind="crisisPlan.potentialTriggers & validate" rows="1"></textarea>
                                            <span class="help-block" repeat.for="errorInfo of potentialTriggersErrors">
                                                ${errorInfo.error.message}
                                            </span>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>What do I find helpful when things are starting to go wrong or in a crisis?*</td>
                                    <td>
                                        <div class="form-group" validation-errors.bind="whatHelpsInCrisisErrors" class.bind="whatHelpsInCrisisErrors.length ? 'has-error' : ''">
                                            <textarea class="form-control" value.bind="crisisPlan.whatHelpsInCrisis & validate" rows="3"></textarea>
                                            <span class="help-block" repeat.for="errorInfo of whatHelpsInCrisisErrors">
                                                ${errorInfo.error.message}
                                            </span>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Action to be taken for care of dependant children?</td>
                                    <td>
                                        <div class="form-group" validation-errors.bind="actionForDependantsErrors" class.bind="actionForDependantsErrors.length ? 'has-error' : ''">
                                            <textarea class="form-control" value.bind="crisisPlan.actionForDependants & validate" rows="3"></textarea>
                                            <span class="help-block" repeat.for="errorInfo of actionForDependantsErrors">
                                                ${errorInfo.error.message}
                                            </span>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>A&E</td>
                                    <td>
                                        <textarea class="form-control no-border fc-readonly" value.bind="crisisPlan.emergencyNumber" readonly="readonly" rows="1"></textarea>
                                        <textarea class="form-control no-border fc-readonly" value.bind="crisisPlan.emergencyLocation" readonly="readonly" rows="1"></textarea>
                                    </td>
                                </tr>
                                <tr>
                                    <td>South Leeds MH Crisis Line</td>
                                    <td><textarea class="form-control no-border fc-readonly" value.bind="crisisPlan.crisisNumber" readonly="readonly" rows="1"></textarea></td>
                                </tr>
                                <tr>
                                    <td>Does the patient agree with and has been provided a copy of their crisis plan?*</td>
                                    <td>
                                        <div validation-errors.bind="patientAcceptsPlanErrors" class.bind="patientAcceptsPlanErrors.length ? 'has-error' : ''">
                                            <label class="radio-inline">
                                                <input type="radio" name="patientAcceptsPlan" model.bind="true" id="patientAcceptsPlan1" checked.bind="crisisPlan.patientAcceptsPlan & validate" value="true"> Yes
                                            </label>
                                            <label class="radio-inline">
                                                <input type="radio" name="patientAcceptsPlan" model.bind="false" id="patientAcceptsPlan2" checked.bind="crisisPlan.patientAcceptsPlan & validate" value="false"> No
                                            </label>
                                            <br if.bind="patientAcceptsPlanErrors.length" />
                                            <span class="help-block" repeat.for="errorInfo of patientAcceptsPlanErrors">
                                                ${errorInfo.error.message}
                                            </span>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <p show.bind="!updatingPlan" class="text-center"><button class="btn btn-primary" click.delegate="savePlan()">Submit</button> <button show.bind="hasCrisisPlan" class="btn btn-danger" click.delegate="deletePlan()">Delete</button></p>
                    </form>
                </div>


                <div show.bind="showNrlsPointers" class="tab-nrls-pointers">
                    <compose view-model="../Base/nrls-pointers/nrls-pointers-table" model.bind="patient.nhsNumber"></compose>
                </div>

            </div>
        </div>

    </section>
</template>
