<template>
    <require from="../Base/patient-search/patient-search"></require>

    <section class="gs-container">

        <p class="gs-instructions">
            <button class="btn btn-primary pull-right" click.delegate="toggleInstructions()">View Instructions</button>
            New Instructions go here...
        </p>

        <div class="generic-system-wrapper yellow-tooltips gs-mht-care-coordinator">

            <div class="gs-header-banner">
                <span class="pull-left">${data.genericSystem.name} Demo System</span> <a href="javascript:void(0);" class="system-close" data-toggle="tooltip" data-placement="top" title="This button is disabled in the Demo."><i class="fa fa-window-close"></i></a>
            </div>

            <div class="gs-header">
                <ul class="gs-top-menu">
                    <li><a href="javascript:void(0)" class="grey-link" data-toggle="tooltip" data-placement="top" title="This tab is disabled in the Demo.">Home</a></li>
                    <li><a href="javascript:void(0)" class="grey-link" click.delegate="findPatient()">Search</a></li>
                    <li><a href="javascript:void(0)" class="grey-link" data-toggle="tooltip" data-placement="top" title="This tab is disabled in the Demo.">Help</a></li>
                    <li class="pull-right">User: <b>${data.personnel.name}</b></li>
                </ul>
            </div>

            <div show.bind="!showPatientSearch" class="gs-patient-banner">
                <span class="item"><strong>${patient.currentName.givenString} ${patient.currentName.family}</strong></span>
                <span class="item"><em>DoB</em> <b>${patient.birthDate | dateFormat : 'YYYY-MM-DDTHH:mm:ss' : 'Do MMM YYYY' }</b></span>
                <span class="item"><b>${patient.gender}</b></span>
                <span class="item"><em>NHS</em> <b>${patient.nhsNumber | nhsNumber}</b></span>
                <span class="item" title.bind="patient.gpPractice.name"><em>GP Practice</em> <b>${patient.gpPractice.orgCode}</b></span>
                <span class="item"><em>Address</em> <b>${patient.currentAddress.line[0]}, ${patient.currentAddress.city}, ${patient.currentAddress.postalCode}</b></span>
            </div>

            <div show.bind="!showPatientSearch" class="gs-sub-header">
                <ul class="gs-records-menu">
                    <li><a href="javascript:void(0)" data-toggle="tooltip" data-placement="top" title="This tab is disabled in the Demo.">Admin</a></li>
                    <li><a href="javascript:void(0)" data-toggle="tooltip" data-placement="top" title="This tab is disabled in the Demo.">Clinical</a></li>
                    <li><a href="javascript:void(0)" data-toggle="tooltip" data-placement="top" title="This tab is disabled in the Demo.">Physical Health</a></li>
                    <li class="active"><a href="javascript:void(0)">Mental Health</a></li>
                    <li><a href="javascript:void(0)" data-toggle="tooltip" data-placement="top" title="This tab is disabled in the Demo.">Allergies</a></li>
                    <li><a href="javascript:void(0)" data-toggle="tooltip" data-placement="top" title="This tab is disabled in the Demo.">Medication</a></li>
                </ul>
            </div>

            <div show.bind="showPatientSearch" class="gs-content">
                <patient-search selected-patient.two-way="selectedPatient" type="full"></patient-search>
            </div>

            <div show.bind="!showPatientSearch" class="gs-content">

                <div class="row">
                    <div class="col-sm-12 gs-tab-panels">
                        <ul class="nav nav-tabs" role="tablist">
                            <li role="presentation"><a href="jacascript:void(0);" data-toggle="tooltip" data-placement="top" title="This button is disabled in the Demo.">Episodes</a></li>
                            <li role="presentation" class="active"><a href="jacascript:void(0);">Care Plan</a></li>
                            <li role="presentation"><a href="jacascript:void(0);" data-toggle="tooltip" data-placement="top" title="This button is disabled in the Demo.">Teams</a></li>
                            <li role="presentation"><a href="jacascript:void(0);" data-toggle="tooltip" data-placement="top" title="This button is disabled in the Demo.">Encounters</a></li>
                            <li role="presentation"><a href="jacascript:void(0);" data-toggle="tooltip" data-placement="top" title="This button is disabled in the Demo.">Treatments</a></li>
                        </ul>

                        <div class="tab-content">
                            <div role="tabpanel" class="tab-pane active" id="nrlstab">

                                <div class="tab-crisis-plan">
                                    <div show.bind="!hasCrisisPlan && !allowCrisisPlan">
                                        <p>No Care Plans Saved. <button class="btn btn-info" type="button" click.delegate="allowCrisisPlan = true">Create Care Plan</button></p>
                                    </div>
                                    <form show.bind="allowCrisisPlan || hasCrisisPlan">

                                        <spinner-msg message="Updating Plan" logic.one-way="updatingPlan"></spinner-msg>

                                        <table show.bind="!updatingPlan" class="table table-striped table-bordered nrls-pointer-results">
                                            <caption>Crisis and Saftey Plan <i class="fa fa-info-circle"></i></caption>
                                            <tbody>
                                                <tr>
                                                    <td width="25%">Do I wish to involve a family member or carer? *</td>
                                                    <td>
                                                        <div validation-errors.bind="involveFamilyOrCarerErrors" class.bind="involveFamilyOrCarerErrors.length ? 'has-error' : ''">
                                                            <label class="radio-inline">
                                                                <input type="radio" name="involveFamilyOrCarer" model.bind="true" id="involveFamilyOrCarer1" checked.bind="crisisPlan.involveFamilyOrCarer & validate" value="true"> Yes
                                                            </label>
                                                            <label class="radio-inline">
                                                                <input type="radio" name="involveFamilyOrCarer" model.bind="false" id="involveFamilyOrCarer2" checked.bind="crisisPlan.involveFamilyOrCarer & validate" value="false"> No
                                                            </label>
                                                            <br if.bind="involveFamilyOrCarerErrors.length" />
                                                            <span class="help-block" repeat.for="errorInfo of involveFamilyOrCarerErrors">
                                                                ${errorInfo.error.message}
                                                            </span>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>What are the signs that I'm feeling well?*</td>
                                                    <td>
                                                        <div class="form-group" validation-errors.bind="signsFeelingUnwellErrors" class.bind="signsFeelingUnwellErrors.length ? 'has-error' : ''">
                                                            <textarea class="form-control" value.bind="crisisPlan.signsFeelingUnwell & validate" rows="1"></textarea>
                                                            <span class="help-block" repeat.for="errorInfo of signsFeelingUnwellErrors">
                                                                ${errorInfo.error.message}
                                                            </span>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>What are the potential triggers?*</td>
                                                    <td>
                                                        <div class="form-group" validation-errors.bind="potentialTriggersErrors" class.bind="potentialTriggersErrors.length ? 'has-error' : ''">
                                                            <textarea class="form-control" value.bind="crisisPlan.potentialTriggers & validate" rows="1"></textarea>
                                                            <span class="help-block" repeat.for="errorInfo of potentialTriggersErrors">
                                                                ${errorInfo.error.message}
                                                            </span>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>What do I find helpful when things are starting to go wrong or in a crisis?*</td>
                                                    <td>
                                                        <div class="form-group" validation-errors.bind="whatHelpsInCrisisErrors" class.bind="whatHelpsInCrisisErrors.length ? 'has-error' : ''">
                                                            <textarea class="form-control" value.bind="crisisPlan.whatHelpsInCrisis & validate" rows="3"></textarea>
                                                            <span class="help-block" repeat.for="errorInfo of whatHelpsInCrisisErrors">
                                                                ${errorInfo.error.message}
                                                            </span>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>Action to be taken for care of dependant children?</td>
                                                    <td>
                                                        <div class="form-group" validation-errors.bind="actionForDependantsErrors" class.bind="actionForDependantsErrors.length ? 'has-error' : ''">
                                                            <textarea class="form-control" value.bind="crisisPlan.actionForDependants & validate" rows="3"></textarea>
                                                            <span class="help-block" repeat.for="errorInfo of actionForDependantsErrors">
                                                                ${errorInfo.error.message}
                                                            </span>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>A&E</td>
                                                    <td>
                                                        <textarea class="form-control no-border fc-readonly" value.bind="crisisPlan.emergencyNumber" readonly="readonly" rows="1"></textarea>
                                                        <textarea class="form-control no-border fc-readonly" value.bind="crisisPlan.emergencyLocation" readonly="readonly" rows="1"></textarea>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>South Leeds MH Crisis Line</td>
                                                    <td><textarea class="form-control no-border fc-readonly" value.bind="crisisPlan.crisisNumber" readonly="readonly" rows="1"></textarea></td>
                                                </tr>
                                                <tr>
                                                    <td>Does the patient agree with and has been provided a copy of their crisis plan?*</td>
                                                    <td>
                                                        <div validation-errors.bind="patientAcceptsPlanErrors" class.bind="patientAcceptsPlanErrors.length ? 'has-error' : ''">
                                                            <label class="radio-inline">
                                                                <input type="radio" name="patientAcceptsPlan" model.bind="true" id="patientAcceptsPlan1" checked.bind="crisisPlan.patientAcceptsPlan & validate" value="true"> Yes
                                                            </label>
                                                            <label class="radio-inline">
                                                                <input type="radio" name="patientAcceptsPlan" model.bind="false" id="patientAcceptsPlan2" checked.bind="crisisPlan.patientAcceptsPlan & validate" value="false"> No
                                                            </label>
                                                            <br if.bind="patientAcceptsPlanErrors.length" />
                                                            <span class="help-block" repeat.for="errorInfo of patientAcceptsPlanErrors">
                                                                ${errorInfo.error.message}
                                                            </span>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>Created</td>
                                                    <td>
                                                        <div class="row">
                                                            <div class="col-sm-5">
                                                                <input class="form-control no-border" value.bind="crisisPlan.planCreated | dateFormat : 'YYYY-MM-DDTHH:mm:ssZ' : 'HH:mma, Do MMM YYYY'" readonly="readonly" />
                                                            </div>
                                                            <div class="col-sm-2 inline-lineheight">Version</div>
                                                            <div class="col-sm-5">
                                                                <input class="form-control no-border" value.bind="crisisPlan.version" readonly="readonly" />
                                                            </div>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>Created By</td>
                                                    <td>
                                                        <div class="row">
                                                            <div class="col-sm-5">
                                                                <input class="form-control no-border" value.bind="crisisPlan.planCreatedBy" readonly="readonly" />

                                                            </div>
                                                            <div class="col-sm-2 inline-lineheight">Job Title</div>
                                                            <div class="col-sm-5">
                                                                <input class="form-control no-border" value.bind="crisisPlan.planCreatedByJobTitle" readonly="readonly" />
                                                            </div>
                                                        </div>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>

                                        <p show.bind="!updatingPlan" class="text-center"><button class="btn btn-info" click.delegate="savePlan()">Submit</button> <button show.bind="hasCrisisPlan" class="btn btn-danger" click.delegate="deletePlan()">Delete</button></p>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <div show.bind="showSystemMessage" class="gs-system-notice">
                    <div class="gs-notice-content text-center">
                        <p textcontent.bind="systemMessage"></p>
                        <p><button class="btn btn-default" click.delegate="setSystemMessage()">Ok</button></p>
                    </div>
                </div>

            </div>

            <div show.bind="instructionsActive" class="gs-instructions">
                <div class="gs-instruction-bg"></div>
                <div class="gs-instruction-content">
                    <p>Instructions go here....</p>
                    <p class="text-center"><button class="btn -btn-default" click.delegate="toggleInstructions()">Ok</button></p>
                </div>
            </div>
        </div>

    </section>
</template>
